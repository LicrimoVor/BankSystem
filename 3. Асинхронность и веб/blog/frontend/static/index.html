<!doctype html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Blog Platform</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family:
					-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
					"Helvetica Neue", Arial, sans-serif;
				background-color: #f5f5f5;
				color: #333;
				line-height: 1.6;
			}

			.container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 0 20px;
			}

			header {
				background-color: #fff;
				border-bottom: 1px solid #ddd;
				padding: 20px 0;
				margin-bottom: 30px;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			}

			.header-content {
				display: flex;
				justify-content: space-between;
				align-items: center;
				max-width: 1200px;
				margin: 0 auto;
				padding: 0 20px;
			}

			.logo {
				font-size: 24px;
				font-weight: bold;
				color: #0066cc;
				cursor: pointer;
			}

			nav {
				display: flex;
				gap: 20px;
				align-items: center;
			}

			nav a,
			nav button {
				text-decoration: none;
				color: #333;
				cursor: pointer;
				border: none;
				background: none;
				font-size: 14px;
				transition: color 0.3s;
			}

			nav a:hover,
			nav button:hover {
				color: #0066cc;
			}

			.page {
				display: none;
			}

			.page.active {
				display: block;
			}

			.form-group {
				margin-bottom: 20px;
			}

			.form-group label {
				display: block;
				margin-bottom: 8px;
				font-weight: 500;
			}

			.form-group input,
			.form-group textarea {
				width: 100%;
				padding: 10px;
				border: 1px solid #ddd;
				border-radius: 4px;
				font-family: inherit;
				font-size: 14px;
			}

			.form-group textarea {
				resize: vertical;
				min-height: 150px;
			}

			button {
				background-color: #0066cc;
				color: white;
				border: none;
				padding: 10px 20px;
				border-radius: 4px;
				cursor: pointer;
				font-size: 14px;
				transition: background-color 0.3s;
			}

			button:hover {
				background-color: #0052a3;
			}

			button.secondary {
				background-color: #666;
			}

			button.secondary:hover {
				background-color: #555;
			}

			button.danger {
				background-color: #dc3545;
			}

			button.danger:hover {
				background-color: #c82333;
			}

			.auth-container {
				max-width: 400px;
				margin: 50px auto;
				background: white;
				padding: 40px;
				border-radius: 8px;
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			}

			.auth-container h2 {
				margin-bottom: 30px;
				text-align: center;
				color: #0066cc;
			}

			.auth-tabs {
				display: flex;
				gap: 10px;
				margin-bottom: 30px;
				border-bottom: 2px solid #eee;
			}

			.auth-tabs button {
				flex: 1;
				background: none;
				color: #666;
				border: none;
				padding: 15px;
				cursor: pointer;
				border-bottom: 3px solid transparent;
				transition: all 0.3s;
				font-weight: 500;
			}

			.auth-tabs button.active {
				color: #0066cc;
				border-bottom-color: #0066cc;
				background-color: transparent;
			}

			.auth-tabs button:hover {
				color: #0066cc;
			}

			.feed {
				display: grid;
				gap: 20px;
			}

			.post-card {
				background: white;
				padding: 20px;
				border-radius: 8px;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
				cursor: pointer;
				transition: box-shadow 0.3s;
			}

			.post-card:hover {
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
			}

			.post-card h3 {
				color: #0066cc;
				margin-bottom: 10px;
				font-size: 18px;
			}

			.post-card .meta {
				color: #999;
				font-size: 12px;
				margin-bottom: 10px;
			}

			.post-card p {
				color: #555;
				line-height: 1.6;
				margin-bottom: 10px;
			}

			.profile-header {
				background: white;
				padding: 30px;
				border-radius: 8px;
				margin-bottom: 30px;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			}

			.profile-header h2 {
				margin-bottom: 15px;
				color: #0066cc;
			}

			.profile-info {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 20px;
				margin-bottom: 20px;
			}

			.profile-info-item {
				padding: 15px;
				background: #f9f9f9;
				border-radius: 4px;
			}

			.profile-info-item strong {
				display: block;
				color: #0066cc;
				margin-bottom: 5px;
			}

			.post-detail {
				background: white;
				padding: 30px;
				border-radius: 8px;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
				margin-bottom: 30px;
			}

			.post-detail h1 {
				color: #0066cc;
				margin-bottom: 15px;
			}

			.post-detail .meta {
				color: #999;
				font-size: 14px;
				margin-bottom: 20px;
				padding-bottom: 20px;
				border-bottom: 1px solid #eee;
			}

			.post-detail .content {
				color: #555;
				line-height: 1.8;
				margin-bottom: 30px;
			}

			.post-actions {
				display: flex;
				gap: 10px;
				margin-top: 30px;
				padding-top: 20px;
				border-top: 1px solid #eee;
			}

			.editor-container {
				background: white;
				padding: 30px;
				border-radius: 8px;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
				max-width: 800px;
				margin: 0 auto;
			}

			.editor-container h2 {
				color: #0066cc;
				margin-bottom: 30px;
			}

			.button-group {
				display: flex;
				gap: 10px;
				margin-top: 20px;
			}

			.button-group button {
				flex: 1;
			}

			.error {
				background-color: #f8d7da;
				color: #721c24;
				padding: 15px;
				border-radius: 4px;
				margin-bottom: 20px;
				border: 1px solid #f5c6cb;
			}

			.success {
				background-color: #d4edda;
				color: #155724;
				padding: 15px;
				border-radius: 4px;
				margin-bottom: 20px;
				border: 1px solid #c3e6cb;
			}

			.loading {
				text-align: center;
				padding: 40px;
				color: #999;
			}

			.spinner {
				border: 4px solid #f3f3f3;
				border-top: 4px solid #0066cc;
				border-radius: 50%;
				width: 40px;
				height: 40px;
				animation: spin 1s linear infinite;
				margin: 0 auto 20px;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}

			.grid-2 {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 30px;
			}

			@media (max-width: 768px) {
				.grid-2 {
					grid-template-columns: 1fr;
				}

				.header-content {
					flex-direction: column;
					gap: 15px;
				}

				nav {
					flex-wrap: wrap;
					justify-content: center;
				}

				.auth-container {
					margin: 20px;
				}
			}

			.hidden {
				display: none !important;
			}

			.empty-state {
				text-align: center;
				padding: 60px 20px;
				color: #999;
			}

			.empty-state h3 {
				margin-bottom: 10px;
				color: #666;
			}
		</style>
	</head>
	<body>
		<header id="header" class="hidden">
			<div class="header-content">
				<div class="logo" onclick="navigateTo('feed')">Blog</div>
				<nav>
					<a
						href="#"
						onclick="
							navigateTo('feed');
							return false;
						"
						>Лента</a
					>
					<a
						href="#"
						onclick="
							navigateTo('profile');
							return false;
						"
						>Профиль</a
					>
					<a
						href="#"
						onclick="
							navigateTo('create');
							return false;
						"
						>Написать</a
					>
					<button onclick="logout()">Выход</button>
				</nav>
			</div>
		</header>

		<!-- AUTH PAGE -->
		<div id="auth-page" class="page active">
			<div class="auth-container">
				<div class="auth-tabs">
					<button class="active" onclick="switchAuthTab('login')">
						Вход
					</button>
					<button onclick="switchAuthTab('register')">
						Регистрация
					</button>
				</div>

				<div id="login-form">
					<h2>Вход</h2>
					<div id="login-error" class="error hidden"></div>
					<form onsubmit="handleLogin(event)">
						<div class="form-group">
							<label>Email</label>
							<input type="email" id="login-email" required />
						</div>
						<div class="form-group">
							<label>Пароль</label>
							<input
								type="password"
								id="login-password"
								required
							/>
						</div>
						<button type="submit">Войти</button>
					</form>
				</div>

				<div id="register-form" class="hidden">
					<h2>Регистрация</h2>
					<div id="register-error" class="error hidden"></div>
					<form onsubmit="handleRegister(event)">
						<div class="form-group">
							<label>Имя пользователя</label>
							<input
								type="text"
								id="register-username"
								required
							/>
						</div>
						<div class="form-group">
							<label>Email</label>
							<input type="email" id="register-email" required />
						</div>
						<div class="form-group">
							<label>Пароль</label>
							<input
								type="password"
								id="register-password"
								required
							/>
						</div>
						<button type="submit">Зарегистрироваться</button>
					</form>
				</div>
			</div>
		</div>

		<!-- FEED PAGE -->
		<div id="feed-page" class="page">
			<div class="container">
				<h1 style="margin-bottom: 30px">Лента постов</h1>
				<div id="feed" class="feed"></div>
				<div id="empty-feed" class="empty-state hidden">
					<h3>Нет постов</h3>
					<p>
						Начните следить за пользователями или
						<a
							href="#"
							onclick="
								navigateTo('create');
								return false;
							"
							>напишите свой пост</a
						>
					</p>
				</div>
			</div>
		</div>

		<!-- PROFILE PAGE -->
		<div id="profile-page" class="page">
			<div class="container">
				<div class="profile-header">
					<h2 id="profile-username"></h2>
					<div class="profile-info">
						<div class="profile-info-item">
							<strong>Email</strong>
							<span id="profile-email"></span>
						</div>
					</div>
					<div style="display: flex; gap: 10px">
						<button onclick="navigateTo('edit-profile')">
							Редактировать
						</button>
						<button onclick="navigateTo('change-password')">
							Изменить пароль
						</button>
						<button class="danger" onclick="deleteAccount()">
							Удалить аккаунт
						</button>
					</div>
				</div>

				<h3 style="margin-bottom: 20px">Мои посты</h3>
				<div id="my-posts" class="feed"></div>
				<div id="empty-my-posts" class="empty-state hidden">
					<h3>Нет постов</h3>
					<p>
						<a
							href="#"
							onclick="
								navigateTo('create');
								return false;
							"
							>Напишите свой первый пост</a
						>
					</p>
				</div>
			</div>
		</div>

		<!-- POST DETAIL PAGE -->
		<div id="post-detail-page" class="page">
			<div class="container">
				<button
					onclick="navigateTo('feed')"
					style="margin-bottom: 20px"
				>
					← Назад
				</button>
				<div class="post-detail">
					<h1 id="post-title"></h1>
					<div class="meta">
						<span id="post-author"></span> •
						<span id="post-date"></span>
					</div>
					<div id="post-content" class="content"></div>
					<div id="post-actions" class="post-actions hidden"></div>
				</div>
			</div>
		</div>

		<!-- CREATE/EDIT POST PAGE -->
		<div id="create-post-page" class="page">
			<div class="container">
				<div class="editor-container">
					<h2 id="editor-title">Написать пост</h2>
					<div id="editor-error" class="error hidden"></div>
					<form onsubmit="handleSavePost(event)">
						<div class="form-group">
							<label>Заголовок</label>
							<input type="text" id="post-input-title" required />
						</div>
						<div class="form-group">
							<label>Содержание</label>
							<textarea
								id="post-input-content"
								required
							></textarea>
						</div>
						<div class="button-group">
							<button
								type="button"
								onclick="navigateTo('feed')"
								class="secondary"
							>
								Отменить
							</button>
							<button type="submit">Сохранить</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<!-- EDIT PROFILE PAGE -->
		<div id="edit-profile-page" class="page">
			<div class="container">
				<div class="editor-container" style="max-width: 600px">
					<h2>Редактировать профиль</h2>
					<div id="edit-profile-error" class="error hidden"></div>
					<form onsubmit="handleSaveProfile(event)">
						<div class="form-group">
							<label>Имя пользователя</label>
							<input type="text" id="edit-username" />
						</div>
						<div class="form-group">
							<label>Email</label>
							<input type="email" id="edit-email" />
						</div>
						<div class="button-group">
							<button
								type="button"
								onclick="navigateTo('profile')"
								class="secondary"
							>
								Отменить
							</button>
							<button type="submit">Сохранить</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<!-- CHANGE PASSWORD PAGE -->
		<div id="change-password-page" class="page">
			<div class="container">
				<div class="editor-container" style="max-width: 600px">
					<h2>Изменить пароль</h2>
					<div id="change-password-error" class="error hidden"></div>
					<form onsubmit="handleChangePassword(event)">
						<div class="form-group">
							<label>Текущий пароль</label>
							<input
								type="password"
								id="current-password"
								required
							/>
						</div>
						<div class="form-group">
							<label>Новый пароль</label>
							<input type="password" id="new-password" required />
						</div>
						<div class="form-group">
							<label>Подтвердить новый пароль</label>
							<input
								type="password"
								id="confirm-password"
								required
							/>
						</div>
						<div class="button-group">
							<button
								type="button"
								onclick="navigateTo('profile')"
								class="secondary"
							>
								Отменить
							</button>
							<button type="submit">Изменить пароль</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<script type="module">
			import init, { Api } from "../pkg/frontend.js";

			let api = null;
			let currentUser = null;
			let currentPostId = null;

			// Initialize WASM module
			async function initWasm() {
				try {
					await init();
					const baseUrl = "http://127.0.0.1:8001";
					api = await new Api(baseUrl);
					checkAuth();
				} catch (err) {
					console.error("Failed to initialize WASM:", err);
				}
			}

			window.checkAuth = async function () {
				try {
					if (!api) return;

					// First, try to refresh the JWT token
					try {
						await api.auth().refresh();
					} catch (err) {
						console.log("Refresh token not available or expired");
						showAuthPage();
						return;
					}

					// Then load user data with refreshed token
					document
						.getElementById("auth-page")
						.classList.remove("active");
					document
						.getElementById("header")
						.classList.remove("hidden");
					navigateTo("feed");
				} catch (err) {
					console.log("Not authenticated");
					showAuthPage();
				}
			};

			window.showAuthPage = function () {
				document.getElementById("header").classList.add("hidden");
				showPage("auth-page");
			};

			window.switchAuthTab = function (tab) {
				document
					.querySelectorAll(".auth-tabs button")
					.forEach((b) => b.classList.remove("active"));
				document
					.querySelectorAll('[id$="-form"]')
					.forEach((f) => f.classList.add("hidden"));

				if (tab === "login") {
					document
						.querySelector(".auth-tabs button:nth-child(1)")
						.classList.add("active");
					document
						.getElementById("login-form")
						.classList.remove("hidden");
				} else {
					document
						.querySelector(".auth-tabs button:nth-child(2)")
						.classList.add("active");
					document
						.getElementById("register-form")
						.classList.remove("hidden");
				}
			};

			window.handleLogin = async function (e) {
				e.preventDefault();
				const email = document.getElementById("login-email").value;
				const password =
					document.getElementById("login-password").value;
				const errorEl = document.getElementById("login-error");

				try {
					errorEl.classList.add("hidden");
					const result = await api.auth().login(email, password);
					currentUser = JSON.parse(JSON.stringify(result));
					document
						.getElementById("auth-page")
						.classList.remove("active");
					document
						.getElementById("header")
						.classList.remove("hidden");
					navigateTo("feed");
				} catch (err) {
					errorEl.textContent = "Неверный email или пароль";
					errorEl.classList.remove("hidden");
				}
			};

			window.handleRegister = async function (e) {
				e.preventDefault();
				const username =
					document.getElementById("register-username").value;
				const email = document.getElementById("register-email").value;
				const password =
					document.getElementById("register-password").value;
				const errorEl = document.getElementById("register-error");

				try {
					errorEl.classList.add("hidden");
					const result = await api
						.auth()
						.register(username, email, password);
					currentUser = JSON.parse(JSON.stringify(result));
					document
						.getElementById("auth-page")
						.classList.remove("active");
					document
						.getElementById("header")
						.classList.remove("hidden");
					navigateTo("feed");
				} catch (err) {
					errorEl.textContent = "Ошибка при регистрации";
					errorEl.classList.remove("hidden");
				}
			};

			window.logout = async function () {
				try {
					await api.auth().logout();
					currentUser = null;
					currentPostId = null;
					showAuthPage();
					switchAuthTab("login");
					document.getElementById("login-email").value = "";
					document.getElementById("login-password").value = "";
				} catch (err) {
					console.error("Logout error:", err);
				}
			};

			window.loadFeed = async function () {
				const feed = document.getElementById("feed");
				const empty = document.getElementById("empty-feed");

				try {
					feed.innerHTML =
						'<div class="loading"><div class="spinner"></div>Загрузка...</div>';
					// In a real app, you'd have a posts endpoint that returns all posts
					// For now, we'll load the user's own posts as a feed
					const result = await api.post().gets_me();
					const posts = Array.isArray(result) ? result : [result];

					if (posts.length === 0) {
						feed.classList.add("hidden");
						empty.classList.remove("hidden");
					} else {
						feed.classList.remove("hidden");
						empty.classList.add("hidden");
						feed.innerHTML = posts
							.map(
								(post) => `
						<div class="post-card" onclick="viewPost('${post.id}')">
							<h3>${escapeHtml(post.title)}</h3>
							<div class="meta">${escapeHtml(post.author_email)} • ${new Date(post.created_at).toLocaleDateString("ru-RU")}</div>
							<p>${escapeHtml(post.content.substring(0, 200))}...</p>
						</div>
					`,
							)
							.join("");
					}
				} catch (err) {
					console.error("Error loading feed:", err);
					feed.innerHTML =
						'<div class="error">Ошибка при загрузке ленты</div>';
				}
			};

			window.loadProfile = async function () {
				try {
					const user = await api.user().me();
					const userData = JSON.parse(JSON.stringify(user));
					currentUser = userData;

					document.getElementById("profile-username").textContent =
						userData.username;
					document.getElementById("profile-email").textContent =
						userData.email;

					const myPosts = await api.post().gets_me();
					const posts = Array.isArray(myPosts) ? myPosts : [myPosts];
					const postsContainer = document.getElementById("my-posts");
					const emptyPosts =
						document.getElementById("empty-my-posts");

					if (posts.length === 0) {
						postsContainer.classList.add("hidden");
						emptyPosts.classList.remove("hidden");
					} else {
						postsContainer.classList.remove("hidden");
						emptyPosts.classList.add("hidden");
						postsContainer.innerHTML = posts
							.map(
								(post) => `
						<div class="post-card" onclick="viewPost('${post.id}')">
							<h3>${escapeHtml(post.title)}</h3>
							<div class="meta">${new Date(post.created_at).toLocaleDateString("ru-RU")}</div>
							<p>${escapeHtml(post.content.substring(0, 200))}...</p>
						</div>
					`,
							)
							.join("");
					}
				} catch (err) {
					console.error("Error loading profile:", err);
				}
			};

			window.viewPost = async function (postId) {
				currentPostId = postId;
				try {
					const post = await api.post().get_by_id(postId);
					const postData = JSON.parse(JSON.stringify(post));

					document.getElementById("post-title").textContent =
						postData.title;
					document.getElementById("post-author").textContent =
						postData.author_email;
					document.getElementById("post-date").textContent = new Date(
						postData.created_at,
					).toLocaleDateString("ru-RU");
					document.getElementById("post-content").textContent =
						postData.content;

					const actionsEl = document.getElementById("post-actions");
					if (
						currentUser &&
						currentUser.email === postData.author_email
					) {
						actionsEl.classList.remove("hidden");
						actionsEl.innerHTML = `
						<button onclick="editPost('${postId}')">Редактировать</button>
						<button class="danger" onclick="deletePost('${postId}')">Удалить</button>
					`;
					} else {
						actionsEl.classList.add("hidden");
					}

					navigateTo("post-detail");
				} catch (err) {
					console.error("Error loading post:", err);
					alert("Ошибка при загрузке поста");
				}
			};

			window.editPost = async function (postId) {
				try {
					const post = await api.post().get_by_id(postId);
					const postData = JSON.parse(JSON.stringify(post));

					currentPostId = postId;
					document.getElementById("editor-title").textContent =
						"Редактировать пост";
					document.getElementById("post-input-title").value =
						postData.title;
					document.getElementById("post-input-content").value =
						postData.content;
					navigateTo("create");
				} catch (err) {
					console.error("Error loading post for edit:", err);
				}
			};

			window.deletePost = async function (postId) {
				if (!confirm("Вы уверены?")) return;
				try {
					await api.post().delete(postId);
					navigateTo("profile");
					loadProfile();
				} catch (err) {
					console.error("Error deleting post:", err);
					alert("Ошибка при удалении поста");
				}
			};

			window.handleSavePost = async function (e) {
				e.preventDefault();
				const title = document.getElementById("post-input-title").value;
				const content =
					document.getElementById("post-input-content").value;
				const errorEl = document.getElementById("editor-error");

				try {
					errorEl.classList.add("hidden");
					if (currentPostId) {
						await api.post().update(currentPostId, title, content);
						currentPostId = null;
					} else {
						await api.post().create(title, content);
					}
					navigateTo("profile");
					loadProfile();
				} catch (err) {
					console.error("Error saving post:", err);
					errorEl.textContent = "Ошибка при сохранении поста";
					errorEl.classList.remove("hidden");
				}
			};

			window.deleteAccount = async function () {
				if (!confirm("Это действие необратимо. Вы уверены?")) return;
				try {
					await api.user().delete();
					logout();
				} catch (err) {
					console.error("Error deleting account:", err);
					alert("Ошибка при удалении аккаунта");
				}
			};

			window.loadEditProfile = function () {
				if (currentUser) {
					document.getElementById("edit-username").value =
						currentUser.username || "";
					document.getElementById("edit-email").value =
						currentUser.email || "";
				}
			};

			window.handleSaveProfile = async function (e) {
				e.preventDefault();
				const username = document.getElementById("edit-username").value;
				const email = document.getElementById("edit-email").value;
				const errorEl = document.getElementById("edit-profile-error");

				try {
					errorEl.classList.add("hidden");
					await api
						.user()
						.update(username || undefined, email || undefined);
					currentUser = {
						...currentUser,
						username,
						email,
					};
					navigateTo("profile");
					loadProfile();
				} catch (err) {
					console.error("Error saving profile:", err);
					errorEl.textContent = "Ошибка при сохранении профиля";
					errorEl.classList.remove("hidden");
				}
			};

			window.handleChangePassword = async function (e) {
				e.preventDefault();
				const currentPassword =
					document.getElementById("current-password").value;
				const newPassword =
					document.getElementById("new-password").value;
				const confirmPassword =
					document.getElementById("confirm-password").value;
				const errorEl = document.getElementById(
					"change-password-error",
				);

				if (newPassword !== confirmPassword) {
					errorEl.textContent = "Пароли не совпадают";
					errorEl.classList.remove("hidden");
					return;
				}

				if (newPassword.length < 6) {
					errorEl.textContent =
						"Пароль должен быть не менее 6 символов";
					errorEl.classList.remove("hidden");
					return;
				}

				try {
					errorEl.classList.add("hidden");
					// Call user().update() with the new password
					await api.user().update(undefined, undefined, newPassword);
					alert("Пароль изменён успешно");
					navigateTo("profile");
				} catch (err) {
					console.error("Error changing password:", err);
					errorEl.textContent = "Ошибка при изменении пароля";
					errorEl.classList.remove("hidden");
				}
			};

			window.navigateTo = function (page) {
				let pageId = page + "-page";
				// Handle special case for create post page
				if (page === "create") {
					pageId = "create-post-page";
				}
				showPage(pageId);
				if (page === "feed") {
					loadFeed();
				} else if (page === "profile") {
					loadProfile();
				} else if (page === "create") {
					document.getElementById("editor-title").textContent =
						"Написать пост";
					document.getElementById("post-input-title").value = "";
					document.getElementById("post-input-content").value = "";
					currentPostId = null;
				} else if (page === "edit-profile") {
					loadEditProfile();
				} else if (page === "change-password") {
					document.getElementById("current-password").value = "";
					document.getElementById("new-password").value = "";
					document.getElementById("confirm-password").value = "";
					document
						.getElementById("change-password-error")
						.classList.add("hidden");
				}
			};

			function showPage(pageId) {
				document
					.querySelectorAll(".page")
					.forEach((p) => p.classList.remove("active"));
				document.getElementById(pageId).classList.add("active");
			}

			function escapeHtml(text) {
				const div = document.createElement("div");
				div.textContent = text;
				return div.innerHTML;
			}

			// Initialize on page load
			window.addEventListener("DOMContentLoaded", initWasm);
		</script>
	</body>
</html>
